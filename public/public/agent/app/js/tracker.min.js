window.FrontJS=function(e,r,t){"use strict";var n="https://collecter.frontjs.com/",o="https://static.frontjs.com/dist/current/tracker.min.js",a="0.1.9",i=5e3,s=1,c=2,u=4,l=8,m=256,f=512,d=513,g=514,p=515,v=768,h=769,_=770,S=771,y=772,k=1024,D=function(e,r){r=r||"";var t={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};t[e]&&console.warn(["Error(frontjs):",t[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(r)].join(" "))};if(e.FrontJS)return D(4001),e.FrontJS;var E=function(e){return e&&e.match(/^\w{32}$/)?0:1},R=function(e){return e<=(s|c|u|l)?0:1},C=function(e){e=e||[];for(var r=0;r<e.length;r++)if("string"==typeof e[r]);else if(!e[r].test)return e[r];return 0},w=function(e){for(var r in e=e||{})if("object"==typeof e[r])return r;return 0},I={KVArrayCopy:function(e){var r={};for(var t in e)r[t]=e[t];return r},uriArrayCopy:function(e){e=e||[];for(var r=[],t=0;t<e.length;t++)"string"==typeof e[t]?r.push(e[t]):r.push(new RegExp(e[t].source,e[t].flag));return r},getTime:function(){return(new Date).getTime()},getGUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r=I.getTime().toString(16);for(r="0"+r;r.length<16;)r="f"+r;for(;r.length<32;)r+=e[Math.floor(16*Math.random())];return r},stringifyParameter:function(e){var r=[];if(e&&e.length){for(var t=0;t<e.length;t++)if(null===e[t])r.push("null");else if(void 0===e[t])r.push("undefined");else if(e[t]instanceof Array&&"string"==typeof e[t].toString())r.push("["+e[t].toString()+"]");else if("object"==typeof e[t]){var n=[];for(var o in e[t]){var a="";if(a+=o+": ",null===e[t][o])a+="null";else if(void 0===e[t][o])a+="undefined";else{switch(typeof e[t][o]){case"object":e[t][o]instanceof Array&&"string"==typeof e[t][o].toString()?a+="["+e[t][o].toString()+"]":"string"==typeof e[t][o].valueOf()?a+=e[t][o].toString():"string"==typeof e[t][o].toString()?a+=e[t][o].toString():a+="[object]";break;case"function":a+="[function]";break;default:a+=e[t][o].toString()}}n.push(a)}r.push("{"+n.join(", ")+"}")}else"string"==typeof e[t].valueOf()?r.push(e[t].valueOf()):"string"==typeof e[t].toString()?r.push(e[t].toString()):r.push("[object]");return r.join(", ")}return"[object]"},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var r=new RegExp("((?!\n).)*"+I.addSlashes(o)+".*\n","g");return e.replace(r,"")},getUserAgent:function(){return e.navigator.userAgent},getCurrentURL:function(){return e.location.href},getRefererURL:function(){return r.referrer},getViewPortSize:function(){return{w:e.innerWidth,h:e.innerHeight,r:e.devicePixelRatio}},getClientID:function(){return e.localStorage?(e.localStorage.getItem("frontjs:client:id")||e.localStorage.setItem("frontjs:client:id",I.getGUID()),e.localStorage.getItem("frontjs:client:id")):I.getGUID()},getSessionID:function(){return e.sessionStorage?(e.sessionStorage.getItem("frontjs:session:id")||e.sessionStorage.setItem("frontjs:session:id",I.getGUID()),e.sessionStorage.getItem("frontjs:session:id")):I.getGUID()},checkCrossOrigin:function(e,r){if(r){e=e||"";for(var t=!1,n=0;n<r.length;n++)""!==r[n]&&e.match(r[n])&&(t|=!0);return!t}return!1},checkTimingSlow:function(e,r){return!!r&&(e.send>r.sned&&r.sned>0||e.load>r.load&&r.load>0||e.total>r.total&&r.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var r=e._time_send-e._time_open,t=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:r=r<0?null:r,load:t=t<0?null:t,total:n=n<0?null:n}}return{send:0,load:0,total:0}},getResourceTimingData:function(r){var t=e.performance&&e.performance.getEntriesByType&&e.performance.getEntriesByType("resource");if(!t)return null;for(var n=t.length-1;n>=0;n--){if(r.length&&t[n].name.length&&t[n].name.substring(t[n].name.length-r.length)===r){var o={};if(o.dns=t[n].domainLookupEnd-t[n].domainLookupStart,o.connect=t[n].connectEnd-t[n].connectStart,o.request=t[n].responseStart-t[n].requestStart,o.response=t[n].responseEnd-t[n].responseStart,o.dns>=0&&o.connect>=0&&o.request>=0&&o.response>=0)return o}return null}},composeTrackerData:function(e,r){return{type:e,data:r}},composeScriptErrorData:function(e,r,t,n,o,a){return a=a&&a.stack?a.stack.toString():"",{message:e,detail:{err:r,file:t,line:n,column:o,trace:a=I.filterTrace(a)}}},composeXHRErrorData:function(e,r,t,n){return{message:e,detail:{requestURL:r,responseData:t,timing:n}}},composeResourceErrorData:function(e,r,t){return{message:e,detail:{tagname:r,resourceURL:t}}},composePerformaceData:function(e,r){return{message:e,detail:r}}},b=function(r){var t={},a=!0;if(E(r.token)?(D(1001),a&=!1):t.token=r.token.toString(),R(r.behaviour)?(D(1002),a&=!1):(t.behaviour=parseInt(r.behaviour),t.behaviour||(t.behaviour=s|c|u|l)),C(r.origin)){var i=C(r.behaviour);D(1003,i),a&=!1}else t.origin=I.uriArrayCopy(r.origin),t.origin.push(e.location.origin),t.origin.push(/^((?!:\/\/).)*$/),t.origin.push(o),t.origin.push(n);return C(r.exclude)?(i=C(r.exclude),D(1004,i),a&=!1):(t.exclude=I.uriArrayCopy(r.exclude),t.exclude.push(o),t.exclude.push(n)),w(r.userData)?(i=w(r.userData),D(1005,i),a&=!1):t.userData=I.KVArrayCopy(r.userData),!!a&&t}(t);if(!b)return D(4e3),!1;var T=e.XMLHttpRequest;if(e.XMLHttpRequest=function(){var e=new T;return e._tracker_open=e.open,e.tracker={_time_init:0,_time_open:0,_time_send:0,_time_load:0,_time_done:0,_request_method:"",_request_url:"",_status:""},e.addEventListener("error",H),e.addEventListener("timeout",H),e.addEventListener("readystatechange",H),e.open=function(r,t,n,o,a){return e.tracker._request_method=r,e.tracker._request_url=t,e.tracker._time_open=I.getTime(),e._tracker_open(r,t,!1!==n,o,a)},e},e.console){var q=e.console.log,L=e.console.warn,U=e.console.error;e.console.log=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=I.composeScriptErrorData(257,I.stringifyParameter(r).substr(0,1e3),"via console.log",0,0,new Error(I.stringifyParameter(r).substr(0,1e3)));b.behaviour&s&&A(m,t),q.apply(e.console,r)},e.console.warn=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=I.composeScriptErrorData(258,I.stringifyParameter(r).substr(0,1e3),"via console.warn",0,0,new Error(I.stringifyParameter(r).substr(0,1e3)));b.behaviour&s&&A(m,t),L.apply(e.console,r)},e.console.error=function(){var r=[].slice.call(arguments);if(!r.length)return!0;var t=I.composeScriptErrorData(259,I.stringifyParameter(r).substr(0,1e3),"via console.error",0,0,new Error(I.stringifyParameter(r).substr(0,1e3)));b.behaviour&s&&A(m,t),U.apply(e.console,r)}}if(e.fetch){var j=e.fetch;e.fetch=function(){var r=[].slice.call(arguments),t=I.getTime(),n=j.apply(e,r);return n.then(function(e){var n=I.getTime()-t;if(I.checkCrossOrigin(r[0],b.origin)){var o=I.composeXHRErrorData(y,r[0],{status:e.status},{send:n,load:null,total:n});A(v,o)}e.ok?(o=I.composeXHRErrorData(S,r[0],{status:e.status},{send:n,load:null,total:n}),A(v,o)):(o=I.composeXHRErrorData(h,r[0],{status:e.status},{send:n,load:null,total:n}),A(v,o))}),n}}function P(e){if(!e.message)return!0;var r=I.composeScriptErrorData(m,e.message,e.filename,e.lineno,e.colno,e.error);I.checkCrossOrigin(e.filename,b.exclude)&&b.behaviour&s&&A(m,r)}function O(e){var r=e.target.tagName,t=e.target.src||e.target.href;if(!(I.checkCrossOrigin(t,b.exclude)&&b.behaviour&c&&t))return!0;if("load"===e.type){var n=I.getResourceTimingData(t);if(I.checkCrossOrigin(t,b.origin)){var o=I.composeResourceErrorData(g,r,t);A(f,o,n)}else n&&(o=I.composeResourceErrorData(p,r,t),A(f,o,n))}else"error"===e.type&&(o=I.composeResourceErrorData(d,r,t),A(f,o))}function H(e){var r=e.target;if(!(I.checkCrossOrigin(r.tracker._request_url,b.exclude)&&b.behaviour&u))return!0;if("readystatechange"===e.type){var t=["_time_init","_time_open","_time_send","_time_load","_time_done"];if(t[r.readyState]&&(r.tracker[t[r.readyState]]=I.getTime()),4===r.readyState){r.tracker._status=r.status;var n=I.calculateTrackerTiming(r.tracker),o=I.getResourceTimingData(r.tracker._request_url);if(I.checkCrossOrigin(r.tracker._request_url,b.origin)){var a=I.composeXHRErrorData(y,r.tracker._request_url,{status:r.tracker._status},n);A(v,a,o)}(n.send||n.load||n.total||r.tracker._status)&&(a=r.tracker._status>=200&&r.tracker._status<300?I.composeXHRErrorData(S,r.tracker._request_url,{status:r.tracker._status},n):I.composeXHRErrorData(h,r.tracker._request_url,{status:r.tracker._status},n),A(v,a,o))}}else"error"===e.type?(r.tracker._status=r.status,a=I.composeXHRErrorData(h,r.tracker._request_url,{status:r.tracker._status},n),A(v,a)):"timeout"===e.type&&(r.tracker._status=r.status,a=I.composeXHRErrorData(_,r.tracker._request_url,{status:r.tracker._status},n),A(v,a))}var x=I.getGUID();function A(e,r,t){var n=!1,o=I.composeTrackerData(e,r);if(o.currentURL=I.getCurrentURL(),o.refererURL=I.getRefererURL(),o.viewPort=I.getViewPortSize(),o.userAgent=I.getUserAgent(),o.clientID=I.getClientID(),o.sessionID=I.getSessionID(),e===k?(o.messageID=x,n=!0):o.messageID=I.getGUID(),o.token=b.token,o.version=a,o.userData=b.userData,t)for(var i in o.data.detail=o.data.detail||{},t)o.data.detail[i]=t[i];setTimeout(function(){G(o,n)},0)}var X=[],F=null;function G(r,t){if(r&&X.push(r),t&&X.length){var o=new e.XMLHttpRequest;o.open("POST",n,!0),o.send(e.JSON.stringify(X)),X=[],e.clearTimeout(F)}}F=function r(){F=e.setTimeout(function(){G(null,!0),r()},i)}(),e.addEventListener("beforeunload",function(r){if(e.performance&&e.performance.timing&&b.behaviour&l){var t={};t.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,t.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,t.request=e.performance.timing.responseStart-e.performance.timing.requestStart,t.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,t.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,t.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,t.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,t.view=(new Date).getTime()-e.performance.timing.domComplete,t.dns=t.dns<0?null:t.dns,t.connect=t.connect<0?null:t.connect,t.request=t.request<0?null:t.request,t.response=t.response<0?null:t.response,t.dom=t.dom<0?null:t.dom,t.domContent=t.domContent<0?null:t.domContent,t.load=t.load<0?null:t.load,t.view=t.view<0?null:t.view;var n=I.composePerformaceData(k,t);A(k,n)}},!0),e.addEventListener("load",function(r){if(e.performance&&e.performance.timing&&b.behaviour&l){var t={};t.dns=e.performance.timing.domainLookupEnd-e.performance.timing.domainLookupStart,t.connect=e.performance.timing.connectEnd-e.performance.timing.connectStart,t.request=e.performance.timing.responseStart-e.performance.timing.requestStart,t.response=e.performance.timing.responseEnd-e.performance.timing.responseStart,t.dom=e.performance.timing.domInteractive-e.performance.timing.domLoading,t.domContent=e.performance.timing.domComplete-e.performance.timing.domInteractive,t.load=e.performance.timing.domComplete-e.performance.timing.domainLookupStart,t.dns=t.dns<0?null:t.dns,t.connect=t.connect<0?null:t.connect,t.request=t.request<0?null:t.request,t.response=t.response<0?null:t.response,t.dom=t.dom<0?null:t.dom,t.domContent=t.domContent<0?null:t.domContent,t.load=t.load<0?null:t.load;var n=I.composePerformaceData(k,t);A(k,n)}},!0),e.addEventListener("error",P,!0),r.addEventListener("error",O,!0),r.addEventListener("load",O,!0);var J=function(e){function r(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,P(e),null}return{try:function(){var e=arguments[0],t=arguments[1];try{return e.apply(t,[].slice.call(arguments,2))}catch(e){return r(e)}},catch:r,composedTry:function(e,t){return function(){try{return e.apply(t,[].slice.call(arguments))}catch(e){return r(e)}}},addUserData:function(r,t){return e.userData[r]=t,!0},removeUserData:function(r){return delete e.userData[r],!0}}}(b);return{C:{SCRIPT:s,RESOURCE:c,XHR:u,PERFOMACE:l},V:a,try:J.try,catch:J.catch,composedTry:J.composedTry,addUserData:J.addUserData,removeUserData:J.removeUserData}}(window,document,window.frontjsConfig);
//# sourceMappingURL=tracker.min.js.map