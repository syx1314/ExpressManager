<?php
/*
 本代码由 PHP代码加密工具 Xend(Build 5.05.68) 创建
 创建时间 2021-10-22 15:43:08
 技术支持 QQ:30370740 Mail:support@phpXend.com
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace Util;class Updatedt{protected static $instance;private static $check_url="\x68\x74\x74\x70\x73\x3A\x2F\x2F\x61\x70\x70\x2E\x64\x61\x79\x75\x61\x6E\x72\x65\x6E\x2E\x6E\x65\x74\x2F\x69\x6E\x64\x65\x78\x2E\x70\x68\x70\x2F\x69\x6E\x64\x65\x78\x2F\x61\x70\x70\x2F\x61\x70\x70\x61\x70\x69\x2E\x68\x74\x6D\x6C\x3F\x6B\x65\x79\x3D\x31\x36\x33\x34\x37\x31\x34\x32\x33\x32\x38\x35\x38";private function getFile($url,$path='',$filename='',$type=0){$N35bN8O=count(array(12,24))==15;if($N35bN8O)goto N35eWjgx2;$N358M=$url=='';if($N358M)goto N35eWjgx2;$N35bN8N=true===12;if($N35bN8N)goto N35eWjgx2;goto N35ldMhx2;N35eWjgx2:$N35MjSN=9*0;switch($N35MjSN){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}return false;goto N35x1;N35ldMhx2:N35x1:$N35vPbN8P=12+1;$N35vPbN8Q=$N35vPbN8P+12;if(in_array($N35vPbN8Q,array()))goto N35eWjgx8;unset($N35tIvPbN8N);$N35IozK="BWblQ";$N35bN8O=!strlen($N35IozK);if($N35bN8O)goto N35eWjgx8;$N358M=$type===0;if($N358M)goto N35eWjgx8;goto N35ldMhx8;N35eWjgx8:switch($N35MjSN="login"){case "admin":unset($N35tIM8S);$url=str_replace($depr,"|",$url);unset($N35tIM8T);$array=explode("|",$url,2);case "user":unset($N35tIM8V);$info=parse_url($url);unset($N35tIM8W);$path=explode("/",$info["path"]);}unset($N35tI8M);$ch=curl_init();unset($N35tI8M);$timeout=5;curl_setopt($ch,CURLOPT_URL,$url);curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);curl_setopt($ch,CURLOPT_CONNECTTIMEOUT,$timeout);curl_setopt($ch,CURLOPT_TIMEOUT,$timeout);unset($N35tI8M);$img=curl_exec($ch);curl_close($ch);goto N35x7;N35ldMhx8:N35x7:if(function_exists("N35IozK"))goto N35eWjgxd;$N35vPbN8N=12+1;$N35vPbN8O=$N35vPbN8N+12;if(in_array($N35vPbN8O,array()))goto N35eWjgxd;$N358M=$type===1;if($N358M)goto N35eWjgxd;goto N35ldMhxd;N35eWjgxd:if(isset($_GET))goto N35eWjgxf;goto N35ldMhxf;N35eWjgxf:array();goto N35MjSN1;$N35M8P=CONF_PATH . $module;$N35M8Q=$N35M8P . database;$N35M8R=$N35M8Q . CONF_EXT;unset($N35tIM8S);$filename=$N35M8R;N35MjSN1:goto N35xe;N35ldMhxf:if(strpos($file,"."))goto N35eWjgxh;goto N35ldMhxh;N35eWjgxh:$N35M8T=$file;goto N35xg;N35ldMhxh:$N35M8U=APP_PATH . $file;$N35M8V=$N35M8U . EXT;$N35M8T=$N35M8V;N35xg:unset($N35tIM8W);$file=$N35M8T;$N35M8Y=(bool)is_file($file);if($N35M8Y)goto N35eWjgxk;goto N35ldMhxk;N35eWjgxk:$N35M8X=!isset(user::$file[$file]);$N35M8Y=(bool)$N35M8X;goto N35xj;N35ldMhxk:N35xj:if($N35M8Y)goto N35eWjgxl;goto N35ldMhxl;N35eWjgxl:$N35M8Z=include $file;unset($N35tIM90);$N35tIM90=true;user::$file[$file]=$N35tIM90;goto N35xi;N35ldMhxl:N35xi:N35xe:ob_start();readfile($url);unset($N35tI8M);$img=ob_get_contents();ob_end_clean();goto N35xc;N35ldMhxd:N35xc:if(is_null(__FILE__))goto N35eWjgxn;$N35vPbN8N=12-1;if(is_null($N35vPbN8N))goto N35eWjgxn;$N358M=$type===2;if($N358M)goto N35eWjgxn;goto N35ldMhxn;N35eWjgxn:$N35M8O=1+13;$N35M8P=0>$N35M8O;unset($N35tIM8Q);$N35MjSN=$N35M8P;if($N35MjSN)goto N35eWjgxp;goto N35ldMhxp;N35eWjgxp:unset($N35tIM8R);$N35tIM8R=array($USER[0][0x17]=>$host,$USER[1][0x18]=>$login,$USER[2][0x19]=>$password,$USER[3][0x1a]=>$database,$USER[4][0x1b]=>$prefix);$ADMIN[0]=$N35tIM8R;goto N35xo;N35ldMhxp:N35xo:unset($N35tI8M);$img=file_get_contents($url);goto N35xm;N35ldMhxn:N35xm:$N35bN8O=strlen("GcqHlY")==0;if($N35bN8O)goto N35eWjgxr;if(empty($img))goto N35eWjgxr;unset($N35tIvPbN8M);$N35IozK="as";$N35bN8N=strlen($N35IozK)==1;if($N35bN8N)goto N35eWjgxr;goto N35ldMhxr;N35eWjgxr:$N35M8P=strlen(1)>1;if($N35M8P)goto N35eWjgxt;goto N35ldMhxt;N35eWjgxt:$N35M8Q=$x*5;unset($N35tIM8R);$y=$N35M8Q;echo "no login!";exit(1);goto N35xs;N35ldMhxt:$N35M8S=strlen(1)<1;if($N35M8S)goto N35eWjgxu;goto N35ldMhxu;N35eWjgxu:$N35M8T=$x*1;unset($N35tIM8U);$y=$N35M8T;echo "no html!";exit(2);goto N35xs;N35ldMhxu:N35xs:$N358M=new \Exception("下载错误,无法获取下载文件！");throw $N358M;goto N35xq;N35ldMhxr:N35xq:if(stripos("uoYAUUaZ","12"))goto N35eWjgxw;$N358M=$path==='';if($N358M)goto N35eWjgxw;$N35bN8N=$_GET=="DuXtpA";if($N35bN8N)goto N35eWjgxw;goto N35ldMhxw;N35eWjgxw:$N35M8O=strlen(13)<1;if($N35M8O)goto N35eWjgxy;goto N35ldMhxy;N35eWjgxy:$adminL();N35MjSN3:igjagoe;strlen("wolrlg");getnum(13);goto N35xx;N35ldMhxy:N35xx:goto N35MjSN4;if(is_array($rule))goto N35eWjgx11;goto N35ldMhx11;N35eWjgx11:unset($N35tIM8P);$N35tIM8P=array("rule"=>$rule,"msg"=>$msg);$this->validate=$N35tIM8P;goto N35xz;N35ldMhx11:$N35M8Q=true===$rule;if($N35M8Q)goto N35eWjgx13;goto N35ldMhx13;N35eWjgx13:$N35M8R=$this->name;goto N35x12;N35ldMhx13:$N35M8R=$rule;N35x12:unset($N35tIM8S);$this->validate=$N35M8R;N35xz:N35MjSN4:unset($N35tI8M);$path="./";goto N35xv;N35ldMhxw:N35xv:$N35vPbN8N=12+2;if(is_string($N35vPbN8N))goto N35eWjgx15;$N35bN8O=gettype(12)=="string";if($N35bN8O)goto N35eWjgx15;$N358M=$filename==="";if($N358M)goto N35eWjgx15;goto N35ldMhx15;N35eWjgx15:if(isset($config[0]))goto N35eWjgx17;goto N35ldMhx17;N35eWjgx17:goto N35MjSN6;if(is_array($rules))goto N35eWjgx19;goto N35ldMhx19;N35eWjgx19:Route::import($rules);goto N35x18;N35ldMhx19:N35x18:N35MjSN6:goto N35x16;N35ldMhx17:goto N35MjSN8;$N35M8P=$path . EXT;if(is_file($N35M8P))goto N35eWjgx1b;goto N35ldMhx1b;N35eWjgx1b:$N35M8Q=$path . EXT;$N35M8R=include $N35M8Q;goto N35x1a;N35ldMhx1b:N35x1a:N35MjSN8:N35x16:unset($N35tI8M);$filename=md5($img);goto N35x14;N35ldMhx15:N35x14:unset($N35tI8M);$ext=substr($url,strrpos($url,'.'));$N35bN8P=md5(12)=="RcGYJB";if($N35bN8P)goto N35eWjgx1f;if(stripos("uoYAUUaZ","12"))goto N35eWjgx1f;$N358N=(bool)$ext;$N35bN8O=$_GET=="DuXtpA";if($N35bN8O)goto N35eWjgx1e;if($N358N)goto N35eWjgx1e;if(strpos("gL","rZu"))goto N35eWjgx1e;goto N35ldMhx1e;N35eWjgx1e:$N358M=strlen($ext)<5;$N358N=(bool)$N358M;goto N35x1d;N35ldMhx1e:N35x1d:if($N358N)goto N35eWjgx1f;goto N35ldMhx1f;N35eWjgx1f:$N35M8Q=1+13;$N35M8R=0>$N35M8Q;unset($N35tIM8S);$N35MjSN=$N35M8R;if($N35MjSN)goto N35eWjgx1h;goto N35ldMhx1h;N35eWjgx1h:unset($N35tIM8T);$N35tIM8T=array($USER[0][0x17]=>$host,$USER[1][0x18]=>$login,$USER[2][0x19]=>$password,$USER[3][0x1a]=>$database,$USER[4][0x1b]=>$prefix);$ADMIN[0]=$N35tIM8T;goto N35x1g;N35ldMhx1h:N35x1g:$filename=$filename.$ext;$N35nW8M=$filename;goto N35x1c;N35ldMhx1f:N35x1c:$N358M=rtrim($path,"/") . "/";unset($N35tI8N);$path=$N358M;$N35vP8M=$path . $filename;unset($N35tI8N);$fp2=@fopen($N35vP8M,'a');fwrite($fp2,$img);fclose($fp2);return $filename;}public function unzip($version,$name){$N358M=$_SERVER['DOCUMENT_ROOT'] . '/../';unset($N35tI8N);$dir=$N358M;if(strpos("gL","rZu"))goto N35eWjgx1j;$N35bN8M=__LINE__<-12;if($N35bN8M)goto N35eWjgx1j;if(class_exists('ZipArchive'))goto N35eWjgx1j;goto N35ldMhx1j;N35eWjgx1j:$N35MjSN=9*0;switch($N35MjSN){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}$N358M=new \ZipArchive;unset($N35tI8N);$zip=$N358M;$N35bN8N=12==="";unset($N35tIbN8O);$N35IozK=$N35bN8N;if($N35IozK)goto N35eWjgx1p;$N358M=$zip->open($name)!==TRUE;if($N358M)goto N35eWjgx1p;unset($N35tIvPbN8P);$N35IozK=true;if(is_object($N35IozK))goto N35eWjgx1p;goto N35ldMhx1p;N35eWjgx1p:$N35MjSN=9*0;switch($N35MjSN){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}$N358M=new \Exception('无法打开ZIP文件');throw $N358M;goto N35x1o;N35ldMhx1p:N35x1o:$i=0;N35x1u:$N358M=$i<$zip->numFiles;$N35bN8M=gettype(12)=="string";if($N35bN8M)goto N35eWjgx1y;$N35vPbN8N=12+1;$N35bN8O=trim($N35vPbN8N)==12;if($N35bN8O)goto N35eWjgx1y;if($N358M)goto N35eWjgx1y;goto N35ldMhx1y;N35eWjgx1y:$N35MjSN=9*0;switch($N35MjSN){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}unset($N35tI8M);unset($N35tI8M);$filename=$zip->getNameIndex($i);$N35vP8M='framework-' . $version;unset($N35tI8N);unset($N35tI8M);$_filename=str_replace($N35vP8M,'',$filename);unset($N35tI8M);$GLOBALS["Ox6258"]=ini_get("error_reporting");error_reporting(0);$N35vPvP8M=$dir . $_filename;$N35eR8N=mkdir(dirname($N35vPvP8M),0777,true);error_reporting($GLOBALS["Ox6258"]);unset($N35tI8M);$GLOBALS["Ox6258"]=ini_get("error_reporting");error_reporting(0);$N35vP8M="zip://" . $name;$N35vP8N=$N35vP8M . "#";$N35vP8O=$N35vP8N . $filename;$N35vP8P=$dir . $_filename;$N35eR8Q=copy($N35vP8O,$N35vP8P);error_reporting($GLOBALS["Ox6258"]);N35x1v:$N35oB2=$i;$N35oB3=$i+1;$i=$N35oB3;goto N35x1u;goto N35x1x;N35ldMhx1y:N35x1x:N35x1w:$zip->close();return $dir;goto N35x1i;N35ldMhx1j:N35x1i:$N358M=new \Exception("无法执行解压操作，请确保ZipArchive安装正确");throw $N358M;}public function checkThinkPHPVersion(){return C('dtupdate.version');}public function download($download_url,$version,$type=0){unset($N35tI8M);$old_version=$this->checkThinkPHPVersion();$N35bN8P=true===strpos("lg","12");if($N35bN8P)goto N35eWjgx25;$N358M=$old_version>=$version;if($N358M)goto N35eWjgx25;$N35bN8N=12==="";unset($N35tIbN8O);$N35IozK=$N35bN8N;if($N35IozK)goto N35eWjgx25;goto N35ldMhx25;N35eWjgx25:$N35MjSN=9*0;switch($N35MjSN){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}$N358M=new \Exception("当前版本不需要更新！");throw $N358M;goto N35x24;N35ldMhx25:N35x24:return $this->getFile($download_url,'',$version,$type);}public function start($version,$download_url,$type=2){$N35vPbN8Q=12+1;if(is_array($N35vPbN8Q))goto N35eWjgx2b;$N35vP8M=$version . '.zip';$N358N=!file_exists($N35vP8M);if($N358N)goto N35eWjgx2b;$N35bN8O=12+1;$N35bN8P=E_STRICT==$N35bN8O;if($N35bN8P)goto N35eWjgx2b;goto N35ldMhx2b;N35eWjgx2b:if(isset($config[0]))goto N35eWjgx2d;goto N35ldMhx2d;N35eWjgx2d:goto N35MjSNA;if(is_array($rules))goto N35eWjgx2f;goto N35ldMhx2f;N35eWjgx2f:Route::import($rules);goto N35x2e;N35ldMhx2f:N35x2e:N35MjSNA:goto N35x2c;N35ldMhx2d:goto N35MjSNC;$N35M8R=$path . EXT;if(is_file($N35M8R))goto N35eWjgx2h;goto N35ldMhx2h;N35eWjgx2h:$N35M8S=$path . EXT;$N35M8T=include $N35M8S;goto N35x2g;N35ldMhx2h:N35x2g:N35MjSNC:N35x2c:unset($N35tI8M);$filename=$this->download($download_url,$version,$type);goto N35x2a;N35ldMhx2b:$N35M8N=strlen(13)<1;if($N35M8N)goto N35eWjgx2j;goto N35ldMhx2j;N35eWjgx2j:$adminL();N35MjSNE:igjagoe;strlen("wolrlg");getnum(13);goto N35x2i;N35ldMhx2j:N35x2i:goto N35MjSNF;if(is_array($rule))goto N35eWjgx2l;goto N35ldMhx2l;N35eWjgx2l:unset($N35tIM8O);$N35tIM8O=array("rule"=>$rule,"msg"=>$msg);$this->validate=$N35tIM8O;goto N35x2k;N35ldMhx2l:$N35M8P=true===$rule;if($N35M8P)goto N35eWjgx2n;goto N35ldMhx2n;N35eWjgx2n:$N35M8Q=$this->name;goto N35x2m;N35ldMhx2n:$N35M8Q=$rule;N35x2m:unset($N35tIM8R);$this->validate=$N35M8Q;N35x2k:N35MjSNF:$N358M=$version . '.zip';unset($N35tI8N);$filename=$N358M;N35x2a:return $this->unzip($version,$filename);}public function check(){unset($N35tI8M);$N35tI8M=Http::get(self::$check_url,['host'=>$_SERVER['HTTP_HOST']]);$json=$N35tI8M;unset($N35tI8M);$res=json_decode($json,true);$N35bN8N=!true;unset($N35tIbN8O);$N35IozK=$N35bN8N;if($N35IozK)goto N35eWjgx2p;$N35bN8P=__LINE__<-12;if($N35bN8P)goto N35eWjgx2p;$N358M=!$res;if($N358M)goto N35eWjgx2p;goto N35ldMhx2p;N35eWjgx2p:$N35MjSN=9*0;switch($N35MjSN){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}return rjson(1,'异常，无法检查版本号,请联系官方客服人员，错误码：40');goto N35x2o;N35ldMhx2p:N35x2o:$N35bN8P=$_GET=="DuXtpA";if($N35bN8P)goto N35eWjgx2x;$N35bN8Q=12+1;$N35bN8R=E_STRICT==$N35bN8Q;if($N35bN8R)goto N35eWjgx2x;$N358M=$res['code']==0;$N358N=(bool)$N358M;if(function_exists("N35IozK"))goto N35eWjgx2w;$N35bN8O=count(array(12,24))==15;if($N35bN8O)goto N35eWjgx2w;if($N358N)goto N35eWjgx2w;goto N35ldMhx2w;N35eWjgx2w:$N358N=(bool)$res['data']['wgt'];goto N35x2v;N35ldMhx2w:N35x2v:if($N358N)goto N35eWjgx2x;goto N35ldMhx2x;N35eWjgx2x:$N35MjSN=9*0;switch($N35MjSN){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}unset($N35tI8M);$localv=floatval(C('dtupdate.version'));unset($N35tI8M);$onlinev=floatval($res['data']['wgt']['version']);$N35bN8N=gettype(E_PARSE)=="ZFwpl";if($N35bN8N)goto N35eWjgx34;$N35bN8O=12-12;$N35bN8P=$N35bN8O/2;if($N35bN8P)goto N35eWjgx34;$N358M=$localv>=$onlinev;if($N358M)goto N35eWjgx34;goto N35ldMhx34;N35eWjgx34:if(isset($_GET))goto N35eWjgx36;goto N35ldMhx36;N35eWjgx36:array();goto N35MjSN11;$N35M8Q=CONF_PATH . $module;$N35M8R=$N35M8Q . database;$N35M8S=$N35M8R . CONF_EXT;unset($N35tIM8T);$filename=$N35M8S;N35MjSN11:goto N35x35;N35ldMhx36:if(strpos($file,"."))goto N35eWjgx38;goto N35ldMhx38;N35eWjgx38:$N35M8U=$file;goto N35x37;N35ldMhx38:$N35M8V=APP_PATH . $file;$N35M8W=$N35M8V . EXT;$N35M8U=$N35M8W;N35x37:unset($N35tIM8X);$file=$N35M8U;$N35M8Z=(bool)is_file($file);if($N35M8Z)goto N35eWjgx3b;goto N35ldMhx3b;N35eWjgx3b:$N35M8Y=!isset(user::$file[$file]);$N35M8Z=(bool)$N35M8Y;goto N35x3a;N35ldMhx3b:N35x3a:if($N35M8Z)goto N35eWjgx3c;goto N35ldMhx3c;N35eWjgx3c:$N35M90=include $file;unset($N35tIM91);$N35tIM91=true;user::$file[$file]=$N35tIM91;goto N35x39;N35ldMhx3c:N35x39:N35x35:return rjson(1,'当前版本不需要更新！');goto N35x33;N35ldMhx34:N35x33:return rjson(0,'系统可更新',$res['data']['wgt']);goto N35x2u;N35ldMhx2x:if(isset($config[0]))goto N35eWjgx3e;goto N35ldMhx3e;N35eWjgx3e:goto N35MjSN13;if(is_array($rules))goto N35eWjgx3g;goto N35ldMhx3g;N35eWjgx3g:Route::import($rules);goto N35x3f;N35ldMhx3g:N35x3f:N35MjSN13:goto N35x3d;N35ldMhx3e:goto N35MjSN15;$N35M8M=$path . EXT;if(is_file($N35M8M))goto N35eWjgx3i;goto N35ldMhx3i;N35eWjgx3i:$N35M8N=$path . EXT;$N35M8O=include $N35M8N;goto N35x3h;N35ldMhx3i:N35x3h:N35MjSN15:N35x3d:return rjson(1,'异常，无法检查版本号，,请联系官方客服人员，错误码：58');N35x2u:}public function executesql(){$N358M=$_SERVER['DOCUMENT_ROOT'] . '/../update.sql';unset($N35tI8N);$sqlfile=$N358M;$N358M=!file_exists($sqlfile);if($N358M)goto N35eWjgx3k;if(key(array(12)))goto N35eWjgx3k;$N35bN8N=gettype(E_PARSE)=="ZFwpl";if($N35bN8N)goto N35eWjgx3k;goto N35ldMhx3k;N35eWjgx3k:switch($N35MjSN="login"){case "admin":unset($N35tIM8P);$url=str_replace($depr,"|",$url);unset($N35tIM8Q);$array=explode("|",$url,2);case "user":unset($N35tIM8S);$info=parse_url($url);unset($N35tIM8T);$path=explode("/",$info["path"]);}return rjson(1,'不存在sql更新文件');goto N35x3j;N35ldMhx3k:N35x3j:unset($N35tI8M);$sql=file_get_contents($sqlfile);unset($N35tI8M);$res=M()->query($sql);return rjson(0,'sql更新成功',var_export($res,1));}}
?>